# Define the compiler and flags
CXX = x86_64-w64-mingw32-g++
CXXFLAGS = -O2 -static

# Define the targets and dependencies
all: slowest.exe

# Compile slow.cpp to slow_writer.o
slow_writer.o: slow.cpp
	$(CXX) $(CXXFLAGS) -c slow.cpp -o slow_writer.o

# Link slow_writer.o to create slow.exe
slow.exe: slow_writer.o
	$(CXX) $(CXXFLAGS) -o slow.exe slow_writer.o

# Generate slow_executable_data.h from slow.exe
slow_executable_data.h: slow.exe
	xxd -i slow.exe > slow_executable_data.h

# Compile slowing.cpp to slowing.o, depends on slow_executable_data.h
slowing.o: slowing.cpp slow_executable_data.h
	$(CXX) $(CXXFLAGS) -c slowing.cpp -o slowing.o

# Compile main.cpp to main.o, depends on slow_executable_data.h
main.o: main.cpp slow_executable_data.h
	$(CXX) $(CXXFLAGS) -c main.cpp -o main.o

# Link slowing.o and main.o to create slowest.exe
slowest.exe: slowing.o main.o
	$(CXX) $(CXXFLAGS) -o slowest.exe slowing.o main.o

# Clean up all generated files
clean:
	rm -f *.o slow.exe slowest.exe slow_executable_data.h
